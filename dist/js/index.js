!function(){function t(t){x.push(t),store.set("task",x)}function e(){h.html(null);for(var t=[],e=0;e<x.length;e++)if(x[e].complate)t[e]=x[e];else{var a=n(e,x[e]);h.prepend(a)}for(var c=0;c<x.length;c++){var s=n(c,t[c]);h.append(s),s&&s.addClass("unline")}var o=$(".delete.r-main"),d=$(".task-list .complate");i(o),l(),u(d),m()}function n(t,e){if(e){var n='<li data-index="'+t+'"><input type="checkbox" '+(e.complate?"checked":"")+' class="complate"><p class="content">'+e.content+'</p><div class="right"><span class="delete r-main">删除</span><span class="deteal r-main">详细</span></div></li>';return $(n)}}function i(t){t.on("click",function(){a($(this).parent().parent().data("index"))})}function a(t){$(".Alert").show(),console.log(t),$(".primary.confirm").bind("click",function(){x.splice(t,1),console.log(t),$(".Alert").hide(),c(),e(),$(".primary.confirm").unbind("click")}),$(".cancel").click(function(){$(".Alert").hide()})}function c(){store.set("task",x)}function l(){$(".deteal.r-main").on("click",function(){var t=$(this).parent().parent().data("index"),e=s(x[t]);h.after(e),d(t),o(),f(),$(".task-detail-mask,.close").click(function(){$(".task-detail").remove(),$(".task-detail-mask").remove()})})}function s(t){var e='<div class="task-detail-mask"></div><div class="task-detail"><form class="up-task"><h2 class="content">'+t.content+'</h2><div class="input-item"><input type="text" id="dbText"></div><div class="input-item"><textarea>'+(t.dsk||"")+'</textarea></div><div class="remind input-item"><label for="b">提醒时间</label><input id="b" class="datetime" type="text" value="'+(t.time||"")+'"></div><div class="input-item"><button>更新</button></div><div class="close">✘</div></form></div>';return $(e)}function o(){$(".task-detail .up-task .content").dblclick(function(){var t=$("#dbText"),e=$(this);e.hide(),t.show(),t.focus(),t.blur(function(){t.hide(),e.show(),t.val()&&e.text(t.val())})})}function d(t){var e=$(".task-detail .up-task");e.on("submit",function(n){n.preventDefault();var i={};i.content=e.find(".content").text(),i.dsk=e.find(".input-item textarea").val(),i.time=e.find(".remind .datetime").val(),r(i,t)})}function r(t,n){x[n]=$.extend({},x[n],t),store.set("task",x),e()}function u(t){t.on("click",function(){var t=$(this).parent().data("index");x[t].complate?r({complate:!1},t):r({complate:!0},t)})}function f(){$.datetimepicker.setLocale("ch"),$(".datetime").datetimepicker({yearStart:2016,yearEnd:2018})}function m(){var t=null;t=setInterval(function(){for(var e=(new Date).getTime(),n=0;n<x.length;n++)!x[n].time||x[n].complate||x[n].off||new Date(x[n].time).getTime()-e<1&&(v(x[n].content),r({off:!0},n),clearInterval(t),p())},1e3)}function p(){document.querySelector("#music").play()}function v(t){$(".msg").show(),$(".msg-content").text(t),$(".msg-btn").click(function(){$(".msg").hide()}),m()}var k=$(".add-task"),h=$(".task-list"),x=[];!function(){x=store.get("task")||[],e()}(),k.on("submit",function(n){n.preventDefault();var i={};i.content=k.find(".text").val(),i.content&&(t(i),k.find(".text").val(null),e())}),m()}();